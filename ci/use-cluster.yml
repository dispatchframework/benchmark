---
platform: linux

image_resource:
  type: docker-image
  source:
    repository: vmware/dispatch-k8s-ci
    tag: v0.0.8

params:
  GKE_KEY:
  GKE_PROJECT_ID:
  K8S_VERSION: 1.9.6-gke.1
  GKE_ZONE: us-west1-c
  CLUSTER_NAME_SUFFIX: job

inputs:
- name: benchmark
- name: dispatch-cli

outputs:
- name: k8s-cluster

run:
  path: /bin/bash
  args:
  - -c
  - |
    set -e -x -u

    cp dispatch-cli/dispatch /usr/local/bin/dispatch

    source benchmark/ci/setup-gke.sh

    export cluster_name=dispatch-ci-nkaashoek-1529355430
    echo ${cluster_name} > k8s-cluster/name

    gcloud container clusters get-credentials ${cluster_name}
